<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eternal Valentine Experience | 2026</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Quicksand:wght@300;400;600&display=swap" rel="stylesheet">

    <style>
        :root {
            --gold: #d4af37;
            --rose: #ff4d6d;
            --dark: #0f0f0f;
            --glass: rgba(255, 255, 255, 0.05);
        }

        body, html {
            margin: 0; padding: 0; width: 100%; height: 100%;
            overflow: hidden; font-family: 'Quicksand', sans-serif;
            background: var(--dark); color: white;
        }

        #canvas-bg { position: fixed; top: 0; left: 0; z-index: 1; }

        .overlay {
            position: relative; z-index: 10;
            width: 100%; height: 100vh;
            display: flex; justify-content: center; align-items: center;
            background: radial-gradient(circle, transparent 10%, rgba(0,0,0,0.7) 100%);
        }

        /* --- GLASS PANEL GENERATOR --- */
        .glass-panel {
            background: var(--glass);
            backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 40px; border-radius: 35px;
            text-align: center; width: 90%; max-width: 450px;
            box-shadow: 0 25px 80px rgba(0,0,0,0.6);
        }

        .gold-label {
            font-family: 'Playfair Display', serif;
            color: var(--gold); letter-spacing: 3px;
            text-transform: uppercase; font-size: 0.7rem; margin-bottom: 15px;
            display: block;
        }

        .main-title {
            font-family: 'Dancing Script', cursive;
            font-size: 3rem; color: var(--rose); margin: 0 0 25px 0;
            text-shadow: 0 0 20px rgba(255, 77, 109, 0.4);
        }

        .input-luxury {
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(212, 175, 55, 0.3);
            padding: 15px 20px; border-radius: 15px;
            color: white; width: 100%; box-sizing: border-box;
            font-size: 0.9rem; margin-bottom: 15px; outline: none;
            transition: 0.4s;
        }

        .input-luxury:focus { border-color: var(--gold); background: rgba(255, 255, 255, 0.15); }

        .btn-luxury {
            background: linear-gradient(45deg, #d4af37, #f9e29c);
            color: #222; border: none; padding: 15px 40px;
            border-radius: 50px; font-weight: 700; cursor: pointer;
            letter-spacing: 1px; transition: 0.4s; width: 100%;
        }

        /* --- ENVELOPE --- */
        #envelope-wrapper { display: none; cursor: pointer; perspective: 1200px; }
        .envelope {
            width: 320px; height: 220px; background: #fff5f6;
            position: relative; transform-style: preserve-3d;
            border-radius: 0 0 10px 10px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
        }
        .envelope-top {
            position: absolute; top: 0; left: 0; width: 0; height: 0;
            border-left: 160px solid transparent; border-right: 160px solid transparent;
            border-top: 120px solid #ffccd5;
            transform-origin: top; transition: 1s cubic-bezier(0.4, 0, 0.2, 1); z-index: 5;
        }
        .open .envelope-top { transform: rotateX(180deg); }

        /* --- CONTENT --- */
        #romantic-content { display: none; text-align: center; max-width: 550px; width: 90%; }
        .letter-paper {
            background: #fff; color: #222; padding: 50px 40px;
            border-radius: 2px; box-shadow: 0 30px 100px rgba(0,0,0,0.8);
            font-family: 'Playfair Display', serif; line-height: 2;
            position: relative;
        }

        .music-viz { position: fixed; bottom: 40px; right: 40px; display: flex; gap: 4px; height: 30px; }
        .bar { width: 3px; background: var(--rose); border-radius: 2px; height: 5px; }
        .hidden { display: none !important; }
    </style>
</head>
<body>

    <canvas id="canvas-bg"></canvas>

    <div class="overlay">
        <div id="step-generator" class="glass-panel">
            <span class="gold-label">Luxury Valentine Generator</span>
            <h1 class="main-title">Eternal Link</h1>
            
            <input type="text" id="girlName" class="input-luxury" placeholder="Nama Pasangan (ex: Adinda)">
            <input type="text" id="girlWA" class="input-luxury" placeholder="WA Pasangan (ex: 08123xxx)">
            <input type="text" id="boyWA" class="input-luxury" placeholder="WA Kamu (ex: 08987xxx)">
            
            <button class="btn-luxury" onclick="generateMagic()">GENERATE MAGIC ‚ú®</button>
            
            <div id="result-box" class="hidden" style="margin-top: 25px;">
                <button class="btn-luxury" style="background: #25d366; color: white;" onclick="sendToWA()">KIRIM KE WHATSAPP ‚ûî</button>
            </div>
        </div>

        <div id="envelope-wrapper" onclick="openLetter()">
            <div class="envelope" id="main-env">
                <div class="envelope-top"></div>
                <div style="position: absolute; inset: 0; display: flex; flex-direction: column; justify-content: center; align-items: center;">
                    <span style="font-size: 2.5rem;">üíå</span>
                </div>
            </div>
            <p style="text-align: center; margin-top: 30px; font-weight: 300; color: var(--gold);">TAP TO OPEN</p>
        </div>

        <div id="romantic-content">
            <div class="letter-paper">
                <h2 id="greet" class="main-title" style="font-size: 2.2rem;"></h2>
                <div id="typed-text" style="font-size: 1.1rem; font-style: italic; color: #444;"></div>
                <div style="margin-top: 40px;">
                    <button class="btn-luxury" onclick="acceptValentine()">YES, I WILL ‚ù§Ô∏è</button>
                </div>
            </div>
        </div>
    </div>

    <div class="music-viz hidden" id="viz">
        <div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div>
    </div>

    <audio id="bgMusic" loop>
        <source src="https://image2url.com/r2/default/audio/1771077456409-72a04b2d-b113-4a8d-ae1e-3125a90d440a.mp3" type="audio/mpeg">
    </audio>

    <script>
        // --- THREE.JS BG ---
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ canvas: document.getElementById('canvas-bg'), antialias: true, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);

        const heartShape = new THREE.Shape();
        heartShape.moveTo(0,0); heartShape.bezierCurveTo(0,0.3,0.3,1,1,1); heartShape.bezierCurveTo(1.7,1,2,0.3,2,0);
        heartShape.bezierCurveTo(2,-0.7,1,-1.5,0,-2.5); heartShape.bezierCurveTo(-1,-1.5,-2,-0.7,-2,0);
        heartShape.bezierCurveTo(-2,0.3,-1.7,1,-1,1); heartShape.bezierCurveTo(-0.3,1,0,0.3,0,0);

        const geometry = new THREE.ShapeGeometry(heartShape);
        const hearts = [];
        for(let i=0; i<100; i++) {
            const material = new THREE.MeshBasicMaterial({ color: i%2===0?0xff4d6d:0xd4af37, transparent:true, opacity:0.4 });
            const mesh = new THREE.Mesh(geometry, material);
            mesh.position.set(Math.random()*40-20, Math.random()*40-20, Math.random()*40-20);
            mesh.rotation.z = Math.PI; mesh.scale.set(0.15,0.15,0.15);
            scene.add(mesh); hearts.push(mesh);
        }
        camera.position.z = 15;
        function animate() { requestAnimationFrame(animate); hearts.forEach(h => { h.rotation.y+=0.01; h.position.y+=0.015; if(h.position.y>15) h.position.y=-15; }); renderer.render(scene, camera); }
        animate();

        // --- WA LOGIC ---
        const urlParams = new URLSearchParams(window.location.search);
        const receiver = urlParams.get('to');
        const senderWA = urlParams.get('by');

        if(receiver) {
            document.getElementById('step-generator').classList.add('hidden');
            document.getElementById('envelope-wrapper').style.display = 'block';
        }

        let generatedLink = "";
        let targetWA = "";

        function generateMagic() {
            const gName = document.getElementById('girlName').value;
            let gWA = document.getElementById('girlWA').value.replace(/\D/g,'');
            let bWA = document.getElementById('boyWA').value.replace(/\D/g,'');

            if(!gName || !gWA || !bWA) return alert("Isi semua data ya!");

            targetWA = gWA.startsWith('0') ? '62' + gWA.slice(1) : gWA;
            const currentSenderWA = bWA.startsWith('0') ? '62' + bWA.slice(1) : bWA;

            const baseUrl = window.location.origin + window.location.pathname;
            generatedLink = `${baseUrl}?to=${encodeURIComponent(gName)}&by=${currentSenderWA}`;
            document.getElementById('result-box').classList.remove('hidden');
        }

        function sendToWA() {
            const msg = "Hai Sayang... ‚ù§Ô∏è\n\nAda sesuatu yang spesial buat kamu di sini. Tolong buka ya:\n\n" + generatedLink;
            window.open("https://wa.me/" + targetWA + "?text=" + encodeURIComponent(msg), '_blank');
        }

        function openLetter() {
            document.getElementById('main-env').classList.add('open');
            document.getElementById('bgMusic').play();
            document.getElementById('viz').classList.remove('hidden');
            gsap.to(".bar", { height: 25, duration: 0.5, stagger: 0.1, repeat: -1, yoyo: true });
            
            setTimeout(() => {
                gsap.to("#envelope-wrapper", { opacity: 0, scale: 0.9, duration: 0.8, onComplete: () => {
                    document.getElementById('envelope-wrapper').classList.add('hidden');
                    document.getElementById('romantic-content').style.display = 'block';
                    startTyping();
                }});
            }, 1200);
        }

        function startTyping() {
            document.getElementById('greet').innerText = "Untukmu, " + receiver;
            const text = "Dalam setiap helai nafasku, namamu adalah doa yang paling sering aku bisikkan. Terimakasih telah hadir dan mengubah duniaku yang biasa menjadi luar biasa. Di hari kasih sayang ini, aku ingin bertanya satu hal yang paling jujur dari hatiku... Maukah kamu menjadi Valentine-ku selamanya?";
            let i = 0;
            function type() {
                if(i < text.length) {
                    document.getElementById('typed-text').innerHTML += text.charAt(i);
                    i++; setTimeout(type, 50);
                }
            }
            type();
        }

        function acceptValentine() {
            confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });
            const reply = "Hai Sayang... ‚ù§Ô∏è\n\nAku baru saja membaca pesanmu. Aku sangat tersentuh... dan jawabannya adalah: YES, I WILL! ‚ù§Ô∏è Aku juga sangat mencintaimu!";
            setTimeout(() => {
                window.open("https://wa.me/" + senderWA + "?text=" + encodeURIComponent(reply), '_blank');
            }, 1500);
        }

        window.addEventListener('resize', () => { camera.aspect = window.innerWidth/window.innerHeight; camera.updateProjectionMatrix(); renderer.setSize(window.innerWidth, window.innerHeight); });
    </script>
</body>
</html>
